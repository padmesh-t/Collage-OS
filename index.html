<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OS Out Of Syllabus</title>
<style>
  body {
    background: #0b0b0b;
    color: #00ffae;
    font-family: "Fira Code", monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 {
    color: #00ffae;
    text-align: center;
  }
  .desc {
    width: 90%;
    max-width: 800px;
    background: #151515;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  select, button {
    background: #00ffae;
    color: #000;
    border: none;
    padding: 10px 20px;
    margin: 5px 5px;
    font-size: 1rem;
    cursor: pointer;
    border-radius: 6px;
  }
  #terminal {
    background: #000;
    width: 90%;
    max-width: 800px;
    height: 400px;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #333;
    overflow-y: auto;
    font-size: 1rem;
    line-height: 1.5;
    white-space: pre-wrap;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  #inputLine {
    width: 100%;
    background: transparent;
    border: none;
    color: #00ffae;
    font-family: "Fira Code", monospace;
    font-size: 1rem;
    outline: none;
  }
  .prompt {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 90%;
    max-width: 800px;
    margin-top: 5px;
  }
  .prompt span {
    margin-right: 5px;
  }
  #clearBtn {
    display: none;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<h1>Team Recursion</h1>

<div class="desc" id="descBox">
  <h3>Program 1 ‚Äì IPC Using Signals</h3>
  <p>This program demonstrates communication between parent and child processes using user-defined signals (SIGUSR1 and SIGUSR2).</p>
</div>

<select id="programSelector" onchange="changeProgram()">
  <option value="1">Program 1 ‚Äì IPC Signals</option>
  <option value="2">Program 2 ‚Äì Buddy Allocator (Interactive)</option>
</select>

<button onclick="runProgram()">‚ñ∂ Run Program</button>
<button id="clearBtn" onclick="resetTerminal()">üßπ Clear Terminal</button>

<div id="terminal"></div>

<div class="prompt" id="promptContainer" style="display:none;">
  <span>&gt;</span>
  <input id="inputLine" type="text" autofocus autocomplete="off" />
</div>

<script>
const terminal = document.getElementById("terminal");
const inputLine = document.getElementById("inputLine");
const promptContainer = document.getElementById("promptContainer");
const descBox = document.getElementById("descBox");
const clearBtn = document.getElementById("clearBtn");

let program = 1;
let memory = Array(32).fill(null);
let runningBuddy = false;

function println(text) {
  terminal.innerText += text + "\n";
  terminal.scrollTop = terminal.scrollHeight;
}

function resetTerminal() {
  terminal.innerText = "";
}

function changeProgram() {
  program = document.getElementById("programSelector").value;
  resetTerminal();
  promptContainer.style.display = "none";
  clearBtn.style.display = "none";

  if (program == 1) {
    descBox.innerHTML = `
      <h3>Program 1 ‚Äì IPC Using Signals</h3>
      <p>This program demonstrates communication between parent and child processes using user-defined signals (SIGUSR1 and SIGUSR2).</p>
    `;
  } else {
    descBox.innerHTML = `
      <h3>Program 2 ‚Äì Buddy Memory Allocation</h3>
      <p>This interactive program simulates a buddy system memory allocator. You can allocate, deallocate memory, and view memory status in real time.</p>
    `;
  }
}

async function runProgram() {
  resetTerminal();
  if (program == 1) {
    let sampleOutput = [
      "[Parent] PID = 1024, created child with PID = 1025",
      "[Child] PID = 1025, waiting for signals...",
      "[Parent] Sending SIGUSR1...",
      "[Child] Received SIGUSR1 - Task 1 running",
      "[Parent] Sending SIGUSR2...",
      "[Child] Received SIGUSR2 - Task 2 running",
      "[Child] Exiting...",
      "[Parent] Communication completed."
    ];
    for (let line of sampleOutput) {
      println(line);
      await new Promise(r => setTimeout(r, 800));
    }
  } else {
    runningBuddy = true;
    memory = Array(32).fill(null);
    println("üß† Buddy Allocator v1.0 - Team Recursion");
    println("Commands: alloc <size>, dealloc <addr>, status, exit");
    println("---------------------------------------------");
    promptContainer.style.display = "flex";
    clearBtn.style.display = "inline-block";
    inputLine.focus();
  }
}

inputLine.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const cmd = inputLine.value.trim();
    println("> " + cmd);
    handleCommand(cmd);
    inputLine.value = "";
  }
});

function handleCommand(cmd) {
  if (!runningBuddy) return;

  cmd = cmd.replace(/[<>]/g, "").trim().toLowerCase();

  if (cmd.startsWith("alloc")) {
    const size = parseInt(cmd.split(" ")[1]);
    const idx = memory.indexOf(null);
    if (isNaN(size) || size <= 0) {
      println("‚ö†Ô∏è Invalid size. Usage: alloc <size>");
    } else if (idx === -1) {
      println("‚ùå No block available");
    } else {
      memory[idx] = size;
      println(`‚úÖ Allocated ${size} units at block ${idx}`);
    }
  } else if (cmd.startsWith("dealloc")) {
    const addr = parseInt(cmd.split(" ")[1]);
    if (!isNaN(addr) && memory[addr] !== null) {
      memory[addr] = null;
      println(`üóëÔ∏è Deallocated block ${addr}`);
    } else {
      println("‚ö†Ô∏è Invalid block or already free");
    }
  } else if (cmd === "status") {
    let allocatedBlocks = memory
      .map((size, i) => size !== null ? `Block ${i}: ${size} units` : null)
      .filter(Boolean);
    if (allocatedBlocks.length === 0) {
      println("üìä No memory allocated.");
    } else {
      println("--- üìä Allocated Blocks ---");
      allocatedBlocks.forEach(b => println(b));
      const total = memory.reduce((a, b) => a + (b || 0), 0);
      println(`Total Allocated: ${total} units`);
    }
  } else if (cmd === "exit") {
    println("üëã Exiting Buddy Allocator...");
    promptContainer.style.display = "none";
    clearBtn.style.display = "none";
    runningBuddy = false;
  } else {
    println("‚ùì Unknown command. Try: alloc <size>, dealloc <addr>, status, exit");
  }
}
</script>

</body>
</html>
